import{r as M,f as R,j,b as F,p as O}from"./vendor-DUuTY2Hv.js";import{L as f}from"./leaflet-BgyWAbY-.js";import{l as P}from"./world-atlas-D5HTYYEg.js";function A(i,b){const r=Number(i),l=Number(b);if(!Number.isFinite(r)||!Number.isFinite(l))return null;const y=(h,a)=>h>=41&&h<=47&&a>=11&&a<=20;return y(r,l)?[r,l]:y(l,r)?[l,r]:Math.abs(r)>90&&Math.abs(l)<=90?[l,r]:Math.abs(l)>180&&Math.abs(r)<=180?[l,r]:[r,l]}function B(i){return i/111320}function C(i,b){const r=Math.cos(b*Math.PI/180)||1;return i/(111320*r)}function v(i,b,r,l=1200,y=50){const h=A(i,b);if(!h)return null;const[a,s]=h,d=(c,E)=>{try{return F(O([E,c]),r)}catch{return!1}};if(!r||!d(a,s))return[a,s];for(let c=y;c<=l;c+=y){const E=B(c),m=C(c,a);for(let L=0;L<24;L++){const k=2*Math.PI*L/24,x=a+Math.sin(k)*E,w=s+Math.cos(k)*m;if(!d(x,w))return[x,w]}}return[a,s]}function G({itinerary:i,activeDay:b,showDebug:r,showSafeRoute:l,showRoute:y}){var w,N;const h=M.useRef(null),a=M.useRef({}),s=M.useMemo(()=>{var o;try{const n=R(P,P.objects.land);return((o=n.features)==null?void 0:o[0])||n}catch{return null}},[]),d=(i==null?void 0:i.days)||[],c=d[b]||null,m=(((w=i==null?void 0:i.safeRoute)==null?void 0:w.waypoints)||((N=c==null?void 0:c.safeRoute)==null?void 0:N.waypoints)||[]||[]).map(o=>v(o.lat,o.lng,s)).filter(Boolean),L=M.useMemo(()=>{if(m.length>1)return m;const o=[];d.forEach(u=>{const p=v(u.fromLat,u.fromLng,s);p&&o.push(p)});const n=d[d.length-1],e=n?v(n.toLat,n.toLng,s):null;return e&&o.push(e),o},[d,s,m]),k=M.useMemo(()=>{const o=[];d.forEach((u,p)=>{const g=v(u.fromLat,u.fromLng,s);g&&o.push({coord:g,dayIndex:p,label:u.from||`Dan ${p+1}`})});const n=d[d.length-1],e=n?v(n.toLat,n.toLng,s):null;return e&&o.push({coord:e,dayIndex:d.length-1,label:`ðŸ ${(n==null?void 0:n.to)||"Cilj"}`,isFinish:!0}),o},[d,s]),x=M.useMemo(()=>{const o=[],n=(e,u)=>{if(!e)return;const p=e.lat??e.latitude??e.fromLat??e.toLat,g=e.lng??e.lon??e.longitude??e.fromLng??e.toLng,t=v(p,g,s);t&&o.push({coord:t,kind:u,name:e.name||e.title||u,raw:e})};return c&&(n(c.marina,"marina"),n(c.anchorage,"anchorage"),n(c.restaurant,"restaurant"),(c.activities||[]).forEach(e=>n(e,"activity"))),o},[c,s]);return M.useEffect(()=>{if(h.current)return;const o=document.getElementById("map");if(!o)return;const n=f.map(o,{zoomControl:!1,preferCanvas:!0});h.current=n,f.control.zoom({position:"topleft"}).addTo(n);const e=f.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18,attribution:"&copy; OpenStreetMap"}),u=f.tileLayer("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,opacity:.75,attribution:"OpenSeaMap"});e.addTo(n),u.addTo(n),a.current.base=e,a.current.seamarks=u,n.setView([44,15],7)},[]),M.useEffect(()=>{const o=h.current;if(!o)return;Object.values(a.current).filter(t=>t&&t instanceof f.Layer&&t!==a.current.base&&t!==a.current.seamarks).forEach(t=>{try{o.removeLayer(t)}catch{}});const n=t=>f.divIcon({className:"poi-marker",html:`<div class="poi-badge">${t}</div>`,iconSize:[34,34],iconAnchor:[17,17]}),e={marina:n("âš“"),anchorage:n("ðŸ–ï¸"),restaurant:n("ðŸ½ï¸"),activity:n("â­")};if(l&&m.length>1){const t=f.polyline(m,{weight:5,opacity:.9,className:"poly-safe"});t.addTo(o),a.current.safeLine=t}if(y&&L.length>1&&m.length<=1){const t=f.polyline(L,{weight:3,opacity:.55,dashArray:"6 10",className:"poly-route"});t.addTo(o),a.current.routeLine=t}const u=[];k.forEach(t=>{const T=f.circleMarker(t.coord,{radius:t.isFinish?9:7,weight:3,opacity:1,fillOpacity:.9,className:t.isFinish?"stop-finish":"stop-marker"}).addTo(o);T.bindPopup(`<div style="font-family:Arial;font-weight:800;color:white;font-size:14px;background:rgba(10,22,40,0.92);padding:8px 10px;border-radius:10px;border:1px solid rgba(59,158,206,0.25)">${t.label}</div>`),u.push(T)}),a.current.stopMarkers=f.layerGroup(u).addTo(o);const p=[];x.forEach(t=>{var I;const T=f.marker(t.coord,{icon:e[t.kind]||e.activity}).addTo(o),$=t.name?`<b>${t.name}</b>`:"",z=(I=t.raw)!=null&&I.description?`<div style="margin-top:6px;opacity:.9">${t.raw.description}</div>`:"";T.bindPopup(`<div style="min-width:220px">${$}${z}</div>`),p.push(T)}),a.current.poiMarkers=f.layerGroup(p).addTo(o);const g=(m.length>1?m:L).concat(k.map(t=>t.coord)).concat(x.map(t=>t.coord));if(g.length>1){const t=f.latLngBounds(g);o.fitBounds(t.pad(.2))}else g.length===1&&o.setView(g[0],12);if(r&&s){const t=f.geoJSON(s,{style:{weight:1,opacity:.5}}).addTo(o);a.current.landLayer=t}},[b,i,s,x,L,m,r,y,l,k]),j.jsx("div",{id:"map",style:{width:"100%",height:"100%"}})}export{G as default};
